
# 🎄FLOW

---
1. 방문 날짜를 입력받는다.
   - **숫자가 아닌 경우 예외 발생**
   - **날짜의 범위가 1 ~ 31일이 아닌 경우 예외 발생** 
   - **null인 경우 예외 발생**
</br></br>
2. 메뉴와 개수를 입력받는다.
   - **입력받은 메뉴가 메뉴판에 없는 경우 예외 발생**
   - **메뉴의 개수가 0개면 예외 발생**
   - **입력받는 메뉴 형식이 다르면 예외 발생**
     - 콤마 다음 공백, - 누락
     - E.g. 
     - 해산물파스타-2,레드와인-1 O
     - 해산물파스타2, 레드와인 1 X
   - **음료만 주문할 경우 예외 발생**
   - **입력된 메뉴가 중복될 경우 예외 발생**
   - **메뉴의 개수가 20개를 넘어가는 경우 예외 발생**
   - **null인 경우 예외 발생**
</br></br>
3. 주문 메뉴를 출력한다.
   - 출력 순서는 고려하지 않는다.
</br></br>
4. 할인 전 총 주문 금액을 출력한다.
   - 주문한 메뉴들의 가격을 모두 더한다.
</br></br>
5. 증정 메뉴를 출력한다.
   - 증정 이벤트에 충족되는 지 검사한다.
     - 할인 전 총 주문 금액이 12만원 이상인 경우
   - 증정 이벤트에 해당하지 않으면 "없음"으로 출력한다.
</br></br>
5. 혜택 내역을 출력한다.
   - 고객에게 적용된 혜택 내역만 출력한다.
   - 적용된 혜택이 없는 경우, "없음"으로 출력한다.
   - 여러 개의 혜택이 적용되었다면, 출력 순서는 고려하지 않는다.
   - 총 주문 금액이 10,000원 이상부터 혜택이 적용된다.
> 혜택(이벤트) 계획
>> 크리스마스 디데이 할인
>> - 이벤트 기간 : 2023.12.1 ~ 2023.12.25
>> - 1,000원으로 시작하여 하루에 할인 금액은 100원씩 증가한다.
>> - 총 주문 금액에서 해당 금액만큼 할인된다.
>> - (e.g. 시작일인 12월 1일에 1,000원, 2일에 1,100원, ..., 25일엔 3,400원 할인)<br>
>
>> 평일 할인 
>> - 이벤트 기간 : 2023.12.1 ~ 2023.12.31
>> - 일요일~목요일에 적용된다.
>> - 디저트 메뉴 1개당 2,023원씩 할인된다.
>
>> 주말 할인 
>> - 이벤트 기간 : 2023.12.1 ~ 2023.12.31
>> - 금요일~토요일에 적용된다.
>> - 메인 메뉴 1개당 2,023원씩 할인된다.
> 
>> 특별 할인
>> - 이벤트 기간 : 2023.12.1 ~ 2023.12.31
>> - 달력에 별이 있는 날 적용된다. (3, 10, 17, 24, 25, 31일)
>> - 총 주문 금액에서 1,000원 할인된다.
>
>> 증정 이벤트
>> - 이벤트 기간 : 2023.12.1 ~ 2023.12.31
>> - 할인 전 총 주문 금액이 12만원 이상일 때, 샴페인 1개가 증정된다.
</br></br>
7. 총 혜택 금액을 출력한다.
   - 총 혜택 금액 = 할인 금액의 합계 + 증정 메뉴(샴페인)의 가격
</br></br>
8. 할인 후 예상 결제 금액을 출력한다.
   - 할인 후 예상 결제 금액 : 할인 전 총 주문 금액 - 할인 금액
</br></br>
9. 12월 이벤트 배지를 출력한다.
   - 이벤트 배지가 부여되지 않았다면 "없음"으로 출력
   - 이벤트 배지는 총 혜택금액으로 발급되며 다음과 같다.
     - 5,000원 이상 : 별
     - 10,000 이상 : 트리
     - 20,000 이상 : 산타

# 🔍 요구 사항 분석

---
- 방문 날짜를 입력받는다.
  - [X] 방문 날짜 입력받기
  - [X] 숫자가 아닌 경우, 예외 처리
  - [X] 날짜의 범위가 1 ~ 31일이 아닌 경우, 예외 처리
  - [X] 문자열이 null인 경우, 예외 처리
</br></br>
- 메뉴와 개수를 입력받는다.
  - [X] 메뉴와 개수를 입력 받는다.
  - [X] 입력받은 메뉴가 메뉴판에 없는 경우, 예외 처리한다.
  - [X] 메뉴의 개수가 0개인 경우, 예외 처리한다.
  - [X] 입력받는 메뉴 형식이 다를 경우, 예외 처리한다.
  - [X] 음료만 주문하는 경우, 예외 처리한다.
  - [X] 입력된 메뉴가 중복될 경우, 예외 처리한다.
  - [X] 메뉴의 개수가 20개를 넘어가는 경우, 예외 처리한다.
  - [X] 문자열이 null인 경우, 예외 처리
</br></br>
- 주문 메뉴를 출력한다.
  - [X] 입력받은 메뉴와 개수를 파싱한다.
  - [X] 메뉴와 개수를 출력한다.
</br></br>
- 할인 전 총 주문 금액을 출력한다.
  - [X] 주문한 메뉴들의 가격을 모두 더해서 총 주문 금액을 계산한다.
  - [X] 총 주문 금액을 출력한다.
</br></br>
- 증정 메뉴를 출력한다.
  - [X] 증정 이벤트를 검사한다. 
    - [X] 할인 전 총 주문 금액이 12만원 이상인 경우
  - [X] 증정 이벤트에 해당하지 않으면 "없음"으로 출력한다.
<br></br>
- 혜택 내역을 출력한다.
  - [X] 날짜를 바탕으로 적용가능한 이벤트를 찾는다.
    - [X] 크리스마스 디데이 할인 검사
    - [X] 평일 할인 검사
    - [X] 주말 할인 검사
    - [X] 특별 할인 검사
  - [X] 고객에게 적용된 이벤트를 출력한다.
    - [X] 크리스마스 디데이 할인
    - [X] 평일 할인
    - [X] 주말 할인
    - [X] 특별 할인
    - [X] 증정 이벤트
  - [X] 적용된 헤택이 없다면 "없음"으로 출력한다.
  - [X] 총 주문금액이 10,000원 이상인지 확인한다.
</br></br>
- 총 혜택 금액을 출력한다.
  - [ ] 적용된 이벤트를 계산하여 총 혜택 금액을 계산한다.
  - [ ] 총 혜택 금액을 출력한다.
</br></br>
- 할인 후 예상 결제 금액을 출력한다.
  - [ ] 할인 전 총 주문 금액과 혜택 금액의 차액을 계산하여 예상 결제 금액을 구한다.
  - [ ] 예상 결제 금액을 출력한다.
</br></br>
- 12월 이벤트 배지를 출력한다.
  - [X] 총 혜택 금액을 바탕으로 배지를 발급한다.
  - [ ] 발급받은 배지를 출력한다.
  - [ ] 발급받은 뱃지가 없다면 "없음"으로 출력한다.

# 📋 기능 명세서

---

# 📢 변경점

---
- 입력값에 null이 들어오는 경우 예외 처리 추가
  - 예약 날짜 테스트를 TDD 방식으로 개발하며, 발견한 예외 상황
  - 이번 미션은 이메일 형식으로 진행하는 만큼 실제 일어날 수 있는 상황을 대처해야 한다는 생각을 하게 되어 null이 입력값으로 들어오는 경우에 대해서도 예외 처리를 하는 것이 맞다고 판단 
</br></br>
- 기존에 다시 입력받기 위해 재귀 사용 -> While문으로 변경
  - 무한 재귀에 빠질 가능성 있다고 판단 + 스택에 쌓이기 때문에 효율성이 떨어짐
</br></br>
- Request(DTO) 삭제 
  - 원본 객체에 있던 Validator를 Class로 따로 빼면서 파싱과 검증을 시킴
  - 값을 입력받다가 유효한 값이 나오는 경우 Valiator에 있는 메소드로 파싱된 값을 반환하고 원본 객체에 생성자 매개변수로 넘겨준다.
  - Validator를 일종의 DTO로 생각하고 진행했다.
    - 파싱과 검증을 하기 때문에 기존에 내가 사용하던 DTO와 비슷하게 사용하고 있다는 생각에 오히려 코드 가독성이 좋다고 판단했다.
  - 유효한 값을 받지 않으면 계속 다시 받아야 하기 때문에 Validator를 DTO로 사용
    - 추후 리팩토링 과정에서 Request(DTO)와 Validator 분리 가능성 있음
    - Request 추가하지 않는다면 Validator로 반환하는 것을 고려
</br></br>
- Response(DTO) 추가
  - 출력값을 OutputView에 그대로 보여주는 것은 좋지 않다고 판단
  - Response 객체를 사용하여 메서드의 반환값이 무엇을 의미하는지 명확하게 전달하기 위해 추가
</br></br>
- Badge 저장
  - 기존에는 저장하지 않고, 할인된 총 액수를 출력하며 뱃지도 같이 출력하려고 했다.
  - 요구사항에서 발급받은 뱃지를 바탕으로 2024년 새해 이벤트 혜택을 주기 때문에 User에서 저장하도록 처리하는 것이 맞다고 판단
# ✅ Test

---
## Domain
### UserTest
- 날짜_숫자_아닌_경우_테스트()
  - 입력 날짜가 숫자가 아닌 경우 예외가 발생한다.
</br></br>
- 날짜_범위_테스트()
  - 입력 날짜의 범위가 1 ~ 31일이 아닌 경우 예외가 발생한다.
</br></br>
- 날짜_빈_문자열_테스트()
  - 입력 날짜가 null인 경우 예외가 발생한다.
</br></br>
- 크리스마스_이벤트_날짜_테스트()
  - 크리스마스 디데이 이벤트가 적용되는 예약일은 True를 반환한다.
</br></br>
- 크리스마스_이벤트_할인_테스트()
  - 크리스마스 디데이 이벤트가 적용되는 예약일의 누적 할인 금액을 반환한다.
    - 누적 할인 금액 : 기본 금액 1000원 + (예약일 X 100)
</br></br>
-  평일_이벤트_날짜_테스트()
  - 평일 이벤트가 적용되는 예약일은 ```true```를 반환한다.
</br></br>
- 주말_이벤트_날짜_테스트()
  - 주말 이벤트가 적용되는 예약일은 ```true```를 반환한다.
</br></br>
- 특별_이벤트_날짜_테스트()
  - 특별 이벤트가 적용되는 예약일은 ```true```를 반환한다.
</br></br>
- 유저_뱃지_발급_테스트()
  - 할인 금액에 따라 뱃지를 지급한다.
### OrderTest
- 입력_메뉴_존재_테스트()
  - 입력받은 메뉴가 존재하지 않으면 예외가 발생한다.
</br></br>
- 메뉴_0개_테스트
  - 입력한 메뉴의 개수가 0개인 경우 예외가 발생한다.
</br></br>
- 입력_형식_테스트()
  - 입력한 메뉴의 형식이 다를 경우 예외가 발생한다.
</br></br>
- 음료수_오직_구매_테스트()
  - 음료수만 구매한 경우 경우 예외가 발생한다.
</br></br>
- 입력_중복_테스트()
  - 입력한 메뉴가 중복인 경우 예외가 발생한다.
</br></br>
- 음식_수량_테스트()
  - 입력한 음식의 수량이 20개가 넘을 경우 경우 예외가 발생한다.
</br></br>
- 주문_문자열_null_테스트()
  - 입력된 주문이 null인 경우 예외가 발생한다.

### FoodOrderTest
- 평일_이벤트_할인_테스트()
  - 평일 이벤트가 적용되는 예약일의 주문한 디저트 메뉴 갯수만큼 누적 할인 금액을 반환한다.
    - 누적 할인 금액 : 디저트 메뉴 갯수 X 2023원
</br></br>
- 주말_이벤트_할인_테스트()
  - 주말 이벤트가 적용되는 예약일의 주문한 메인 메뉴 갯수만큼 누적 할인 금액을 반환한다.
    - 누적 할인 금액 : 메인 메뉴 갯수 X 2023원
</br></br>
- 선물_증정_이벤트_최소_금액_테스트()
  - 할인 전 총 주문 금액이 12만원을 넘으면 ```true```를 반환한다.
## Service
### OrderService
- 주문_내역_테스트()
  - 주문 내역을 제대로 반환하는지 확인한다.
</br></br>
- 할인_전_주문_금액_테스트()
  - 할인 전 총 주문 금액을 제대로 반환하는지 확인한다.
</br></br>
- 증정_이벤트_테스트()
  - 할인 전 총 주문금액이 12만원을 넘으면 샴페인이 지급된다.